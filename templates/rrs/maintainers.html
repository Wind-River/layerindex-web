{% extends "rrs/base_toplevel.html" %}
{% load i18n %}
{% load staticfiles %}

{% load url from future %}

{% comment %}

  rrs-web - maintainers page template

  Copyright (C) 2015 Intel Corporation
  Licensed under the MIT license, see COPYING.MIT for details

{% endcomment %}

{% block navs %}
{% endblock %}

{% block content_inner %}
<div class="navbar navbar-table-controls">
    <div class="navbar-inner table-controls">
        <ul class="nav">
            <li class="dropdown">
            <span class="badge" style="margin-top:11px;"></span>
            </li>
        </ul>    		
        <form id="form-search" class="navbar-form pull-right">
            <input type="text" class="input-xxlarge" placeholder="Search maintainers" id="filter">				
            <button type="submit" value="Search" class="btn btn-info" id="btn-search">Search</button>
        </form>
    </div>
</div>

<div id="no_maintainers_alert" class="alert">
    No maintainers found <a href="#" id="view-all-maintainers" style="margin-left:10px;">View all maintainers</a>
</div>
<table class="table table-bordered table-hover" id="statistics-table">
<thead>
    <tr>
        <th class="sorted">Maintainer<b class="caret"/></th>
        <th class="muted">Assigned recipes</th>
        <th class="muted">Up-to-date</th>
        <th>Not updated</th>
        <th class="muted">Can't be updated</th>
        <th class="muted">Unknown</th>
        <th>% done</th>

        {% for w in milestone_weeks %}
        {% if current_week == forloop.counter0 %}
        <th class="current-wk">
        {% else %}
        <th class="muted">
        {% endif %}
        wk{{ w }}
        </th>
        {% endfor %}
    </tr>
</thead>
<tbody>
{% for ml in maintainer_list %}
    <tr>
        <td>
            {{ ml.name }}
        </td>
        <td>
            <a href="{% url 'recipes' release_name milestone_name %}?maintainer_name={{ ml.name|urlencode }}">
                {{ ml.recipes_all }}
            </a>
        </td>
        <td>
            <a href="{% url 'recipes' release_name milestone_name %}?upstream_status={{ "Up-to-date"|urlencode }}&maintainer_name={{ ml.name|urlencode }}">
                {{ ml.recipes_up_to_date }}
            </a>
        </td>
        <td>
            <a href="{% url 'recipes' release_name milestone_name %}?upstream_status={{ "Not updated"|urlencode }}&maintainer_name={{ ml.name|urlencode }}">
                {{ ml.recipes_not_updated }}
            </a>
        </td>
        <td>
            <a href="{% url 'recipes' release_name milestone_name %}?upstream_status={{ "Can't be updated"|urlencode }}&maintainer_name={{ ml.name|urlencode }}">
                {{ ml.recipes_cant_be_updated }}
            </a>
        </td>
        <td>
            <a href="{% url 'recipes' release_name milestone_name %}?upstream_status={{ "Unknown"|urlencode }}&maintainer_name={{ ml.name|urlencode }}">
                {{ ml.recipes_unknown }}
            </a>
        </td>
        <td>{{ ml.percentage_done }}</td>
        {% for number in ml.week_statistics %}
            {% if current_week == forloop.counter0 %}
            <td class="current-wk">
            {% else %}
            <td class="muted">
            {% endif %}
            {{ number }}
            </td>
        {% endfor %}
    </tr>
{% endfor %}
</tbody>
</table>
{% endblock %}

{% block scripts %}
<script src="{% static "js/uitablefilter.js" %}"></script>
<script src="{% static "js/jquery.tablesorter.js" %}"></script>
<script>
$(document).ready(function() {
    statisticsTable = $('#statistics-table');

    function updateMaintainerCount() {
        $('#statistics-table').show()
        $('#no_maintainers_alert').hide()

        count = 0
        $('tr:visible').each(function() {
            count++
        });

        if (count == 1) {
            $('#statistics-table').hide()
            $('#no_maintainers_alert').show()
        }

        if (count == 2) {
            $('.badge').html("1 maintainer");
        } else {
            $('.badge').html((count - 1) + " maintainers")
        }
    }

    $("#form-search").submit(function( event ) {
        search_text = $("#filter").val()
        $.uiTableFilter(statisticsTable, search_text);
        updateMaintainerCount()
        event.preventDefault();
    });

    $("#view-all-maintainers").click(function() {
        $.uiTableFilter(statisticsTable, '');
        $("#filter").val('')
        updateMaintainerCount()
    });

{% if maintainer_count > 0 %}
    $(statisticsTable).tablesorter({
        sortList: [[0,0]],
        headers: {
            1: { sorter: false },
            2: { sorter: false },
            3: { sorter: false },
            4: { sorter: false },
            5: { sorter: false },
            6: { sorter: false },
            7: { sorter: false },
            8: { sorter: false },
            9: { sorter: false },
            10: { sorter: false },
            11: { sorter: false },
            12: { sorter: false },
            13: { sorter: false },
            14: { sorter: false },
        }
    });
{% endif %}

    updateMaintainerCount()
});
</script>
{% endblock %}
