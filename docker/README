# Layerindex Docker images

The layerindex depends on several pieces of software:

- A database such as mariadb
- RabbitMQ as a task queue for Celery
- A reverse proxy such as Nginx for performance

The docker-compose.yaml file will start up a full stack of the 4
containers necessary to simulate a full production system on a single
machine using docker-compose.

    > docker-compose up --abort-on-container-exit
    > docker-compose rm --force -v

# Building the layerindex image

    > docker build -t yocto/layerindex-app .

# Manual creation of the database

Start a database server. We use MariaDB in production. See
docker/mariadb_settings.py for an example settings required to connect
to Mariadb and RabbitMQ

If you have a copy of the the production data now is the time to insert it.
If not you can skip the next step for a clean install.

    > xzcat ./layerdb.sql.xz | docker run -i --link layerdb:layersdb \
         --rm mariadb sh -c 'exec mysql -hlayersdb -uroot -p"testingpw" layersdb'
